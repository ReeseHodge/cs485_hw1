<!DOCTYPE html> 
<html>  
<head>
    <title>(Game Title)</title>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
</head>
<body>
<div id="game_text"></div>
<ul id="movement" justified="left">
    <h1>Move in what Direction?</h1>
    <button id="north" onclick="key_input(north)">North</button>
    <button id="west" onclick="key_input(west)">West</button>
    <button id="east" onclick="key_input(east)">East</button>
    <button id="south" onclick="key_input(south)">South</button>
    <button id="interact" onclick="key_input(interact)">interact</button>
</ul>
<ul id="main">
    <h1>Main Menu:</h1>
    <button id="inventory" on_click="ShowInventory()">Inventory</button>
    <button id="characters" on_click="showCharacters()">Characters</button>
    <button id="Save" onclick="saveFile()">Save</button>
    <button id="Exit" on_click="exit()">Exit</button>
</ul>
<button onclick="toggle_menu('main')">Main Menu</button>
<button onclick="toggle_menu('movement')">Movement Menu </button>
<script>
    $.ajax();
var game_data;
var currentState;
var next_state_current;
var directionArray=[];
//gets the game data from GameMap.json
jQuery.getJSON("GameMap.json",function(data){
        game_data=data;
        currentState=data["start_state"]
        console.log("Current_State = "+currentState);
        $('#game_text').html(game_data["states"][currentState]["text"])
})
//sets the next state
function next_state(state){
    currentState=state
    $('#game_text').html(game_data["states"][currentState]["text"]);
}
//determines what key was pressed and runs next_state function to get the next state in the game.
function key_input(what_key){
    for (i=0; i<game_data["states"][currentState]["next_state"].length;i++){
        console.log(currentState)
        if (what_key.id==game_data["states"][currentState]["next_state"][i]["key_input"]){
            next_state(game_data["states"][currentState]["next_state"][i]["state_name"]);
        }
        else if (currentState=="game_play"){
            console.log(what_key.id)
            if (what_key.id=="Save"){
                save();
            }
        }
    }
}

function setDirectionsAvailable(number){
    if (number==null){
        totalWays=randomInt(4);
    }else{
        totalWays=number;
    }
    j=0;
    while(j<totalWays){
        i=0;
        while (i<directionArray.length){
            directionObj=randomInt(1,4);
            if (directionObj!=directionArray[i]){
                directionArray.append(directionObj);
                j++;
                break;
            }
            i++;
        }
    }
    return directionArray;
}

function showChoiceMenu(type){
    menu=game_data["ChoiceMenus"][type];
    for( item in menu){
        $('#game_text').html(menu[item]["Text"])
    }
}

function generateRooms(){
    roomType=setRoomType()
    for (i=0; i<game_data["roomTypes"].length;i++){
        if (game_data["roomTypes"][i]==roomType){
            id=roomType["id"];
            if (id==0){
                console.log("empty")
            }else if(id==1){
                console.log("Chest")
            }else if(id==2){
                console.log("Enemy")
            }else if(id==3){
                console.log("Mimic")
            }else if(id==4){
                console.log("Shop")
            }else if(id==5){
                console.log("Boss")
            }else if(id==6){
                console.log("Treasure")
            };
        }
    }
}

//function gets a room type from the list of 7 types except for 
function setRoomType(){
    selection=randomInt(game_data["roomTypes"].length-1)-1;
    console.log("Selection:="+selection);
    if (selection!=6){
        return game_data["roomTypes"][selection];
    }else{
        return setRoomType();
    }
}

function randomVar(type){
    selection=randomInt(game_data[type].length);
    return game_data[type][selection];
}

//function calculates stimulus and dopamine calculator
function addRoomStimulusAndDope(roomType){
    game_data["currentStimulus"]+=game_data["roomTypes"][roomType]["stimulusChange"];
    game_data["currentDopamine"]+=game_data["roomTypes"][roomType]["dopamineChange"];
}

//Function Below is Built to Ensure that every playthrough is different.
function randomInt(i){
    return Math.floor(Math.random() * i)+1;
}
//save file creation
function  saveFile(){
    writeFile("save.txt",game_data);
}
function writeFile(fileHandle, contents) {
    // Create a FileSystemWritableFileStream to write to.
    const writable = fileHandle.createWritable();

    // Write the contents of the file to the stream.
    writable.write(contents);

    // Close the file and write the contents to disk.
    writable.close();
}
//Function Below toggles visibility by menu.
function toggle_menu(idValue){
    hidden=document.getElementById(idValue).hidden
    if (hidden){
        document.getElementById(idValue).hidden=false;
    }else{
        document.getElementById(idValue).hidden=true;
    }
}
//Function Below terminates game.
function exit(){
    return 0;
}









</script>
</body>
</html>
